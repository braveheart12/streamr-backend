<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
<link rel="import" href="../../../js/polymer/polymer.html">
<script src="../../../js/highstock-2.0.3/highstock.js"></script>
<script src="../../../js/unifina/streamr-chart/streamr-chart.js"></script>


<polymer-element name="streamr-chart" attributes="channel rangeDropdown showHideButtons">
	<template>
		<streamr-client id="client"></streamr-client>
		<div id="container"></div>
	</template>
	
	<script>
		Polymer('streamr-chart',{
			publish: {
				rangeDropdown: false,
				showHideButtons: false
			},
			ready: function() {
				var _this = this
				// Takes parent element as argument
				var chart = new StreamrChart(this.$.container, {
					rangeDropdown: this.rangeDropdown,	// default: true
					showHideButtons: this.showHideButtons	// default: true
				})
				var trySubscribe = function() {
					if(_this.$.client.streamrClient) {
						var client = _this.$.client.streamrClient
						client.subscribe(
						    _this.channel, 
						    function(message) {
						    	console.log(message)
						    	chart.handleMessage(message)
						    },
						    { 
						        resend_all: true
						    }
						)
					}
					else {
						setTimeout(trySubscribe, 200)
					}
				}
				trySubscribe()
			}
		});
	</script>
</polymer-element>